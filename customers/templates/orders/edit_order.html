{% extends 'base.html' %}

{% block content %}
<div class="content">
    <div class="container mt-5">
  <h2 class="text-center mb-4">Edit Order #{{ order.id }}</h2>

  {% if messages %}
    <div class="alert-container">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <form method="POST">
    {% csrf_token %}
    <div class="card mb-4">
      <div class="card-header bg-primary text-white"><h5>Products</h5></div>
      <ul class="list-group list-group-flush">
        {% for entry in product_list %}
          {% with p=entry.product %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div class="form-check">
                <input class="form-check-input product-checkbox"
                       type="checkbox"
                       name="products"
                       value="{{ p.id }}"
                       id="prod_{{ p.id }}"
                       {% if entry.selected %}checked{% endif %}>
                <label class="form-check-label" for="prod_{{ p.id }}">
                  {{ p.name }} (In stock: {{ p.stock }})
                </label>
              </div>
              <div class="d-flex align-items-center">
                <input type="number"
                       name="quantity_{{ p.id }}"
                       class="form-control form-control-sm me-2 quantity-input"
                       value="{{ entry.quantity }}"
                       min="1"
                       max="{{ p.stock }}"
                       {% if not entry.selected %}disabled{% endif %}>
                <span class="badge bg-secondary rounded-pill">
                  Kshs {{ p.price }}
                </span>
              </div>
            </li>
          {% endwith %}
        {% endfor %}
      </ul>
    </div>

    <div class="d-flex justify-content-between">
      <button type="submit" class="btn btn-success">Update Order</button>

    </div>
  </form>
</div>
</div>


<script>
  // Toggle quantity inputs when checkboxes change
  document.querySelectorAll('.product-checkbox').forEach(cb => {
    cb.addEventListener('change', () => {
      const qty = document.querySelector(`input[name=quantity_${cb.value}]`);
      if (qty) qty.disabled = !cb.checked;
    });
  });
</script>
{% endblock %}
